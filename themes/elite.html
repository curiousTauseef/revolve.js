<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Elite Theme | Revolve.js</title>
  <meta name="description" content="A precision analog clock-and-gauge library in standard JavaScript.">
  <meta name="keywords" content="JavaScript,gauge,clock,analog clock,HTML,canvas">
  <meta name="author" content="James M. Devlin">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css?family=Playfair+Display|Merriweather&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/webfont/1.3.0/webfont.js" type="text/javascript"></script>
  <script src="../js/revolve.js" type="text/javascript"></script>
  <link href="../css/main.css" type="text/css" rel="stylesheet">
  <script type="text/javascript">

  // Revolve.js gauges and clocks can use custom web fonts from, for example,
  // Google Fonts. Here we're using a popular dynamic web font loader library
  // to kick off initialization of Revolve.js when necessary fonts have
  // loaded.

  WebFont.load({
    google: {
      families: ['Oswald:300,400','Quattrocento','Six Caps'] // fonts we want
    },
    active: function() { // (Okay, fonts have loaded!)

      // Get the canvas element
      let can = document.querySelector('canvas');

      // Prepare the theme. This may entail an asynchronous load of the theme
      // JSON file, so we use the _loadTheme helper to handle the timing. Note:
      // you can also specify the theme object directly, as a JavaScript object,
      // in which case everything is synchronous. That's what we do below when
      // the clock/gauge is re-rendered from the JSON in the <textarea> input
      // field.
      let theme = can.dataset.theme || 'classic';
      if( typeof theme === 'string' ) {
        _loadTheme( theme, ret => {
          document.getElementById('raw').value = ret;
          theme = JSON.parse( ret );
          doRender( can, theme );
        });
      }

    }
  });

  // Our main clock-and-gauge rendering function. Called on page load AND
  // whenever the Render button is clicked.

  function doRender( can, theme ) {
    can = can || document.querySelector('canvas');
    let ds = can.dataset, opt = {
      value: ds.value || '10:10:00',
      paused: true,
      theme: theme || ds.theme,
      events: [
        { name: 'daytime', from: '06:30',  to: '20:17' },
        { name: 'status',  from: '09:30',  to: '10:00' },
        { name: 'work',    from: '09:00',  to: '17:00' },
        { name: 'lunch',   from: '12:00',  to: '13:00' },
        { name: 'dinner',  from: '18:00',  to: '19:00' },
        { name: 'sleep',   from: '23:00',  to: '07:00' }
      ],
    };
    if( ds.theme === 'stopwatch' ) { opt.paused = true; }
    if( !can.ctl ) { // Path A: Initialize the clock or gauge for the 1st time
      if( ds.theme === 'speedometer' || ds.theme === 'dartboard' ||
          ds.theme === 'pressure' || ds.theme === 'unitless' ) {
        can.ctl = Revolve.gauge( can.getContext('2d'), opt );
      }
      else {
        can.ctl = Revolve.clock( can.getContext("2d"), opt );
      }

      can.onclick = function() { // Start/stop the clock when clicked.
        if( can.ctl.paused )     // (can be collapsed to a single line)
          can.ctl.start();
        else
          can.ctl.stop();
      }
    }
    else { // Path B: Render the existing clock/gauge
      can.ctl.theme = JSON.parse( document.querySelector('textarea').value );
      can.ctl.render();
    }
  }

  // Load a Revolve.js theme asynchronously.
  // https://codepen.io/KryptoniteDove/post/load-json-file-locally-using-pure-javascript
  function _loadTheme( themeName, callback ) {
     let xobj = new XMLHttpRequest();
     xobj.overrideMimeType("application/json");
     xobj.open('GET', '/themes/' + themeName + '.json', true); // synchronous load, for now
     xobj.onreadystatechange = function () {
       if (xobj.readyState == 4 && xobj.status == "200") {
         // Required use of an anonymous callback as .open will NOT return a value
         // but simply returns undefined in asynchronous mode
         callback( xobj.responseText );
       }
     };
     xobj.send(null);
  }

  </script>
</head>
<body id="theme">
  <main>
    <header>
      <h1>Theme: Elite</h1>
      <p><a href="/">Revolve.js v1.2.0</a></p>
      <p><p>A stylized clock face with Roman lettering in the radial style.</p>
</p>
    </header>

    <section id="live">
      <h2>Live</h2>
      <div>
        <canvas width="512" height="512" data-theme="elite"></canvas>
      </div>
    </section>

    <section id="json">
      <h2>JSON</h2>
      <div>
        <textarea id="raw">
        </textarea>
        <input type="button" value="Render!" onClick="doRender();">
      </div>
    </section>

    <footer>
      <a href="https://github.com/hacksalot/revolve.js">Revolve.js</a>
      by <a href="https://github.com/hacksalot">Hacksalot</a> |
      <span><a href="https://github.com/hacksalot/revolve.js/releases/tag/v1.2.0">Version 1.2.0</a></span> | Copyright (c) 2019
    </footer>
  </main>
</body>
</html>
